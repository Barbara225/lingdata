### Конвертация между ELAN и TextGrid  

#### 1. Экспорт в TextGrid  
Разметку .eaf файла можно представить в TextGrid вьюере и сохранить в табличном формате  
* Файл -> Экспорт -> Текст с разделителями (CSV)
* Параметры таблицы: имя слоя, начальное время, конечное время, аннотация  

#### 2. Импорт из TextGrid  
* Файл -> Импорт -> Текст с разделителями (CSV)  
Укажите, какие столбцы какому типу информации соответствуют (имя слоя, начальное время, конечное время, аннотация).  
После этого нужно указать свойства каждого слоя,  так как TextGrid эту информацию не хранит.  
* Тип -- Импортируйте типы слоев из файла-образца ELAN, чтобы у вас появились типы utterance, word и т. д.  
* Слой - Изменить -- задайте свойства слоя (тип utterance, метку говорящего, разметчика, язык)  

#### 3. Подготовка файла транскрипта к импорту (регулярные выражения)  
Откройте файл с расшифровкой (*.transcript.txt).  

##### 3.1 Препроцессинг  
С помощью регулярных выражений, уберите пробелы в конце строки и пробелы до и после знака разделителя реплик `//`:  
* `<пробел>*/*<пробел>*$` --> <пустая строка> -- $ означает конец строки, /* - повторение слэша любое число раз, если встретится  
* `<пробел>*//<пробел>*` --> `//` -- удалит пробелы до и после разделителя реплик  
Удалите все строки, которые не начинаются с метки говорящего (@...):  
* `^[^@].*\n` -- <пустая строка>  -- здесь "крышка" обозначает начало строки, крышка внутри квадратных скобок - любой символ кроме указанного за ним.   
(Если у вас формат конца строк состоит из двух символов (CR LF), то укажите \r\n вместо \n).  

#### 3.2 Формат в два столбца  
После метки говорящего у вас в транскрипте стоит пробел. Замените его на символ табуляции.  
* `^(@.+?) ` --> `\1-text\t`  -- здесь \1 означает, что все, что найдено по первой скобке, нужно оставить. После него допишем -text как название слоя, потом поставим табуляцию.    
(Если у вас редактор Atom, работающий с регулярными выражениями языка Perl, то вместо \1 укажите $1).  

#### 3.3 Каждая реплика на своей строке (но с названием слоя в начале)  
Уже сейчас вы можете попробовать импортировать получившийся TextGrid в ELAN.  
Но наверняка есть строки, где говорящий произносит несколько реплик. Перенесем каждую реплику на свою строку.  
* `^(@.+?)\t(.+?)\\` --> `\1\t\2\n\1\t` --  находит метку говорящего, за ним пробел, за ним подстроку до первого вхождения // (ленивый поиск). При замене вместо // мы вставляем конец строки и метку говорящего перед продолжением реплик.     

#### 3.4 Импорт транскрипта в ELAN  
Сохраните текстовый файл и импортируйте его в ELAN (см. п. 2). 
В конце не забудьте указать свойства для каждого слоя.  
